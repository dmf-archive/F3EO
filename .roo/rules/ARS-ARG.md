# ARS & ARG: 探索流形上的平坦度约束

状态: 实验中 (2025-12-31)
注意: 目前两者在 Wikitext-2 上的表现均不佳，本文件仅记录设计思路与研究目标。

## 1. 研究动机：超越测地线滑行

[`AdaRMSuon`](optimizer/ada_rmsuon.py) 证明了沿着测地线滑行能带来极高的收敛效率，但也揭示了缺乏复杂度控制导致的灾难性过拟合。ARS 与 ARG 的共同目标是在流形优化中引入**平坦度 (Flatness)** 约束，以寻找泛化性能更好的宽阔盆地。

## 2. ARS (AdaRMSuon-SAM): 时间步对齐的扰动

### 2.1 设计思路
ARS 试图解决传统 SAM 的双采样逻辑与 AdaRMSuon 流形约束之间的冲突。
- **TA-ARS (Time-Aligned ARS)**: 将扰动视为一种“延迟补偿”。
- **单次采样**: 每个 step 仅进行一次 BP，假设当前梯度是对前一时刻扰动的响应。
- **流形一致性**: 确保所有的预处理和结构算子在当前的参数坐标系下执行。

### 2.2 目标
- 消除双采样带来的统计量污染。
- 在不增加显存开销的前提下，验证流形上的对抗扰动是否能提升泛化。

## 3. ARG (AdaRMSuon-GAM): 一阶平坦度约束

### 3.1 设计思路
ARG 引入了基于梯度范数的平坦度约束，旨在最小化 Hessian 的最大特征值。
- **GAM 算子**: 关注扰动半径内的最大梯度范数 $||\nabla L||$。
- **HVP 驱动**: 利用 Hessian-Vector Product 计算一阶锐度惩罚：
  `meta_grad = \nabla_{\theta} ||\nabla L||^2 \approx H \cdot \nabla L`
- **复杂度项**: 在数学上将 GAM 视为自由能原理中 `Complexity` 项的显式优化。

### 3.2 目标
- 抑制 AdaRMSuon 导致的锐利解过拟合。
- 验证仅在特定层（如 LayerNorm）激活 HVP 修正的有效性。

## 4. 待验证猜想

1. **流形扰动的一致性**: 在 Stiefel 流形上进行的对抗扰动，其几何意义是否依然等价于欧氏空间中的平坦度寻找？
2. **二阶信息的必要性**: ARG 使用的 HVP 是否比 ARS 的一阶扰动更能准确捕捉地形曲率？
3. **计算开销平衡**: 在追求泛化的过程中，如何保持二阶优化器原有的速度优势？
