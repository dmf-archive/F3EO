# F3E 系列优化器清理与符号修正方案（已完成）

1. **F3EW**:
   - **假设**: 仅用 `–Hg` 更新，抛弃一阶梯度。
   - **结果**: 训练陷入“零梯度-随机准确率”死区，违反自由能原理。
2. **F3EL**:
   - **假设**: 用主损失 `L` 缩放三阶梯度 `δ_meta`。
   - **结果**: 粗糙的线性缩放，已被更精细的 PI 信号反馈（F3EPI）取代。
3. **F3EPI-AdaX**:
   - **假设**: 解耦 `g` 与 `δ_meta` 的自适应归一化。
   - **结果**: 首版实现存在致命的尺度失配 bug，导致参数爆炸。
4. **F3EO (raw)**:
   - **假设**: 无约束地最大化复杂度 `g - δ_meta`。
   - **结果**: 必然过拟合，已被 F3EPI 的 PI 反馈机制取代。
5. **F3EPI-RMS**:
   - **假设**: 在 F3EPI 基础上引入 RMSProp 式的自适应学习率。
   - **结果**: Wikitext-2 实验显示收敛速度不及 F3EO，性能不佳。

---

## F3E-Warp

F3E-Warp 核心假设是“用未归一化的曲率放大步长替代传统梯度下降”。

`θ ← θ – 2Hg`，理论学习率固定 1.0；通过 `meta_grad_clip_norm` 裁剪抑制发散；不再与一阶梯度累加。

- 把优化目标从“最速下降”改为“梯度变化最快方向”，预期借高曲率区域实现“引力弹弓”式跃迁。
- 鞍点处负曲率方向自动产生反向推力，理论上加速逃逸。
- 实现保留 Adam 动量，对 `Hg` 做平滑，形成“Momentum(Hg)”稳定变体。

CIFAR-10 + ResNet-18，与 AdamW、F3EO 对照；监控早期稳定性、收敛曲线、最终准确率；`meta_grad_clip_norm` 初始 1.0 可调。

训练迅速陷入“梯度为零但准确率随机”的无效状态；诊断发现更新仅含 `–∇Complexity`，缺失 `∇Accuracy` 锚定项，违反自由能原理，导致模型被推向与任务无关的“最简单”参数区。
  实验同时暴露检查点保存 BUG，已改为每 epoch 轮动写入。

F3E-Warp 假设被证伪，却反向验证 F3EO 理论完备性：`g – δ_meta` 二者缺一不可。**代码已彻底移除，仅留文档为警示**，团队回归并继续完善 F3EO 主线。

## F3EL: F3EO with Loss-scaling

F3EL 用主损失 `L` 缩放三阶复杂度梯度 `δ_meta`（`g_eff = g − L·δ_meta`），试图在训练后期抑制过拟合。该思路已被 **F3EPI** 取代，后者以预测完整性 `PI` 为反馈信号，实现更精细的协同平衡。

## 数据处理流程的语义破坏

在 `wikitext-2` 任务的早期实现中，我们采用了将所有文章拼接成一个长序列再进行切块（`Concatenate and Chunk`）的数据处理策略。事实证明，这种方法在文章边界处制造了不符合语法的、破坏语义连贯性的人工序列连接。这种对训练数据的噪声注入，被证明是导致模型（特别是高效率的 F3EPI 优化器）过早进入过拟合状态的根本原因。正确的做法是应在每篇文章内部独立进行切块，以完全尊重其语义边界。该问题已在 `task/wikitext2.py` 中修复。
