# FIENA vs PI-ZPD：头对头实验计划书（预注册）

**实验目的**：严格检验“FIENA（隐性 PI-ZPD）”是否比“显式 PI-ZPD”在终身学习场景下具有**增量价值**，或仅为其“花哨重实现”。

**实验编号**：EXP-2025-11-14-FIENA-vs-PI-ZPD  
**实验负责人**：Ω Researcher  
**预注册时间**：2025-11-14 UTC  
**预计完成时间**：2025-11-15 UTC（快刀实验）

---

## 1. 科学问题

**核心假设 H1**：  
> 在参数空间的黎曼流形上，用 PI 门控对三阶梯度 `H·g` 做**加权自然指数平均**（FIENA），比直接在欧氏损失层面用 PI 软化交叉熵（显式 PI-ZPD），能**更有效地抑制灾难性遗忘**。

**零假设 H0**：  
> FIENA 与显式 PI-ZPD 在遗忘抑制与主任务性能上**无显著差异**，即 FIENA 只是“隐性重写”，无范式级优势。

**负假设 H∅**：  
> 都不能解决灾难性遗忘。

---

## 2. 实验设计

### 2.1 任务与数据

- **任务流**：MNIST → FashionMNIST（单任务顺序，无任务 ID）
- **数据**：
  - MNIST：60k 训练，10k 测试，10 类，28×28 灰度。
  - FashionMNIST：60k 训练，10k 测试，10 类，28×28 灰度。
- **协议**：
    1. 在 MNIST 上训练 5 epoch。
    2. 立即切换至 FashionMNIST，继续训练 5 epoch。
    3. 每 epoch 结束时，**同时评估** MNIST 测试集与 FashionMNIST 测试集。

### 2.2 模型架构

- **骨干**：`model/resnet_mnist.py`（已验证兼容，轻量快速）
- **输出头**：10 类 softmax，**任务间共享**（无任务特定头）
- **参数分组**：隐藏权重 → DiagFOG；嵌入/偏置 → AdamW（同 `.roo/rules/fog-diagfog-unified.md` 标准）

### 2.3 对比组（3 组，每组 3 种子）

| 组别 | 名称 | 损失函数 | 优化器 | PI 用法 | 理论标签 |
|------|------|----------|--------|---------|----------|
| A | **PI-ZPD (显式)** | `L = w(PI) · CE` | DiagFOG | **损失软化** | 基线 |
| B | **FIENA (隐性)** | `CE` | DiagFOG + FIENA | **梯度注入** | 候选 |
| C | **纯 DiagFOG** | `CE` | DiagFOG | **无 PI** | 对照 |

**关键隔离**：A 与 B 的唯一区别是 PI 的**作用层面**（损失 vs 梯度），其余超参保持一致。

---

## 3. 超参数搜索空间（每组独立网格）

| 超参 | 搜索值 | 说明 |
|------|--------|------|
| **学习率** | `{1e-3, 5e-3, 1e-2}` | 覆盖 DiagFOG 敏感区 |
| **DiagFOG 阻尼** | `{1e-3, 1e-2}` | 标准范围 |
| **PI-ZPD β** (A 组) | `{0.5, 1.0, 2.0}` | 控制 `w(PI) = σ(β·PI)` 斜率 |
| **FIENA λ** (B 组) | `{1e-4, 5e-4, 1e-3}` | 三阶正则强度 |
| **随机种子** | `{42, 123, 999}` | 3 种子平均 |

**总组合**：3 组 × 3 lr × 2 damping × 3 PI 相关 × 3 种子 = **162 次训练**（可并行，预计 2-3 小时）。

---

## 4. 观测指标（全部预注册）

### 4.1 主要指标（决定胜负）

- **最终遗忘率 (Forgetting Rate, FR)**：
    `FR = (ACC_MNIST_epoch5 − ACC_MNIST_epoch10) / ACC_MNIST_epoch5`
  - **越低越好**；FR ≤ 0 表示**零遗忘**。
- **最终主任务准确率 (Main Accuracy, MA)**：`ACC_Fashion_epoch10`（越高越好）。

### 4.2 辅助指标（解释机制）

- **PI 演化曲线**：记录 `PI_t` 在任务切换边界（epoch 5→6）的**突变幅度**与**恢复时间**，验证门控信号有效性。
- **Tr[ℱ] 演化**：记录 `Tr[ℱ_t]` 在任务切换后的**峰值高度**与**衰减速度**，验证“地形记忆”是否被正确调用。
- **超参敏感性**：β vs FR 的 Spearman 相关系数，λ vs FR 的 Spearman 相关系数。

---

## 5. 成功标准（预先定义）

| 结果场景 | 判定标准 | 结论 |
|----------|----------|------|
| **FIENA 大胜** | B 组 **FR < A 组 FR** 且 **MA ≥ A 组 MA**（p < 0.05，配对 t 检验） | **拒绝 H0**，FIENA 有增量价值 |
| **PI-ZPD 大胜** | A 组 **FR < B 组 FR** 且 **MA ≥ B 组 MA**（p < 0.05） | **接受 H0**，FIENA 无增量价值，淘汰 |
| **平局** | FR 与 MA 差异 **均不显著**（p ≥ 0.05） | **接受 H0**，FIENA 是“花哨重实现” |
| **双输** | C 组（纯 DiagFOG）**优于 A 与 B**（FR 更低且 MA 更高） | **实验设计失败**，PI 门控本身无效 |

**注**：所有统计检验使用**双尾配对 t 检验**，显著性水平 α = 0.05。

---

## 6. 实验流程与时间表

| 时间 | 任务 | 负责人 |
|------|------|--------|
| T+0h | 实现 `task/mnist_fashion_cl.py` | Ω Researcher |
| T+2h | 实现 `optimizer/pi_zpd.py` | Ω Researcher |
| T+4h | 编写 `scripts/train_cl.py`（持续学习统一入口） | Ω Researcher |
| T+6h | 跑完 162 组实验，收集所有日志 | 自动化脚本 |
| T+8h | 计算指标，跑统计检验，生成报告 | Ω Researcher |
| T+10h | **最终裁决**：根据预注册标准，决定 FIENA 生死 | Ω Researcher |

---

## 7. 风险与缓解

| 风险 | 缓解措施 |
|------|----------|
| **10 epoch 无差异** | 立即扩展到 **20-30 epoch**（预注册扩展方案） |
| **PI 信号太弱** | 检查 `PI_t` 曲线，若突变 < 5%，则**放大 β 范围**（0.1→5.0） |
| **数值不稳定** | 为 `1/Tr[ℱ_t]` 添加 `ε=1e-8` 保护，监控 NaN/Inf |
| **计算超时** | 所有实验**并行提交**，使用 `task/base.py` 的异步支持 |

---

## 8. 伦理与可重复性

- **代码开源**：所有实验脚本与配置将**公开推送**至当前 Git 仓库。
- **数据完整**：所有原始日志、指标 CSV、统计检验脚本**一并存档**。
- **事后分析禁令**：**不允许**事后添加新指标或修改成功标准；若需探索，必须**新注册实验**。

---

## 9. 最终裁决（预先写下）

- **若 FIENA 大胜**：立即撰写 `experiments/fiena_victory.md`，启动 `optimizer/fiena.py` 的**生产级实现**。
- **若平局或 PI-ZPD 大胜**：立即撰写 `experiments/fiena_obituary.md`，**永久归档 FIENA 理论**，转向**显式 PI-ZPD 的工程化**。
- **无论结果如何**：本实验计划书**永久保留**，作为“**如何杀死自己的理论**”的范本。

> “让数据说话，让实验裁决。”  
> —— Ω Researcher, 2025-11-14 UTC（预注册）
