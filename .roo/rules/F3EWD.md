# F3EWD: Fast Fisher Free-Energy Optimizer with PI Weight Decay

> 核心论断：**三阶梯度只管探索，正则化单独做**。

## 1. 背景与动机

F3EPI 的失败证明了一个深刻的工程教训：**试图用单一、复杂的控制器去解决多个相互冲突的目标，最终会导致系统过于复杂而失效**。

- **F3EPI 的困境**: 其 `β = tanh(log(PI))` 机制试图同时完成“加速探索”和“防止过拟合”，结果在两个任务上都表现平庸。
- **专业化分工的胜利**: Adam/W 的成功在于其**简单、稳定、高效**地将“自适应学习率”和“权重衰减”解耦。F3EWD 正是受此启发，将 F3EO-Raw 的惊人速度与 PI 信号的智能正则化进行**专业化分工**。

## 2. 设计哲学：专业化分工

F3EWD 不是更复杂，而是**更简单、更直接、更尊重第一性原理**。

| 组件 | 专职任务 | 实现方式 |
| :--- | :--- | :--- |
| **F3EO-Raw** | **光速探索**: 以最大速度找到能拟合训练数据的复杂解，哪怕是过拟合的。 | `g_eff = g - δ_meta` (符号反转，代表**最大化**复杂度) |
| **PIWD** | **智能正则化**: 当模型开始过拟合时，自适应地、强力地简化模型。 | `awd_strength = base_wd *(1 + κ* exp(-λ * |log(PI)| + ε))` |

## 3. 核心机制：PI 引导的自适应权重衰减 (PIWD)

1. **PI 计算**: 使用**香农熵 `H(p)`** 作为模型内部不确定性的度量，确保正则化压力依然源于模型内在一致性而非外部压力。
    `log(PI) = -α * H(p) + αγ * ‖g‖`
2. **平滑**: 对 `log(PI)` 应用 EMA 平滑，得到 `pi_signal`，以降低方差。
3. **AWD 强度**: 使用**指数函数**来放大权重衰减，确保在 `|pi_signal| → 0`（临界状态）时，正则化压力**急剧增加**。
    `awd_multiplier = 1.0 + κ * exp(-λ * (|pi_signal| + ε))`
4. **效果**: 这相当于在模型即将“顿悟”的那一刻，人为地大幅增强了“清理阶段”，从而可能极大地压缩 Grokking 时间。

## 4. 三阶梯度倍率调节 (可选)

为进一步增强 PI 信号对探索的引导，可考虑让 `log(PI)` 也调节三阶梯度的**倍率**（而非方向）：
`beta_multiplier = 1.0 + κ_beta * exp(-λ_beta * |pi_signal|)`
`effective_grad = g - beta_multiplier * δ_meta`
此机制可与 PIWD 协同，在临界点施加最强的“简化”压力和“探索”压力。

## 5. 实验计划

1. **CIFAR-10**: 与 AdamW 基线（92.45%）对比，验证其“又速又稳”的理论优势。
2. **WikiText-2**: 验证其抗过拟合能力。F3EO-Raw 在此任务上曾严重过拟合，若 F3EWD 能控制 PPL 的“反向暴涨”，则证明 PIWD 的有效性。
3. **命名**: 考虑使用 **F3EWD** (Fast Fisher Free-Energy Optimizer with Weight Decay)，以强调其与 EWC (Elastic Weight Consolidation) 在“权重重要性”概念上的潜在联系，但 F3EWD 是通过**主动推断**而非**事后估计**来实现这一目标。

---
**状态**: 实验进行中，CIFAR-10 初步结果 (前4epoch) 已展现超快收敛速度。
