# Spectral Residual Momentum (SRM): 失败分析与理论修正

**日期**: 2025-11-26
**状态**: 实验失败 (Hypothesis Falsified)

## 1. 核心假设回顾

SRM 基于以下逻辑链条：

1. **度量**: 谱残差 $\rho = \|g_{nat} - \text{Ortho}(g_{nat})\|_F$ 度量了 KFAC 预条件后的梯度偏离 Stiefel 流形的程度。
2. **诠释**: $\rho$ 越大，说明局部几何越扭曲（KFAC 白化失败），不确定性越高。
3. **行动**: 引入动量阻尼 $\beta_{eff} = \beta(1 - \tanh(\gamma \rho))$，在不确定区域减速。

## 2. 实验证据

在 CIFAR-10 ResNet-18 实验中：

- **诊断信号**: Conv2d 层的 $\rho$ 持续维持在高位 ($0.6 \sim 0.8$)，从未下降。Linear 层较低但呈上升趋势。
- **干预结果**: 引入 SRM 阻尼后，模型性能崩溃。

## 3. 根本原因分析 (Root Cause Analysis)

### A. 信号误读：$\rho$ 是功而非过

在 Hadron 架构 (KFAC + Muon) 中，Muon 的作用是**补救** KFAC 的残余谱结构。

- $\rho$ 高意味着 KFAC 留下了大量非球形结构，Muon 正在进行剧烈的正交化修正。
- 这正是 Muon 发挥价值的时刻。
- SRM 在此时通过阻尼动量来"惩罚"这种修正，实际上是**在病人最需要手术的时候关掉了呼吸机**。

### B. 动力学对抗

- **Muon**: 试图通过正交化加速穿越病态曲率区域。
- **SRM**: 试图在病态区域减速。
- 两者在动力学上构成了直接的对抗，导致优化器陷入停滞。

## 4. 理论修正：从阻尼到增益

如果我们要利用 $\rho$ 信号，逻辑必须反转：

**Inverse SRM (iSRM)**:
当 $\rho$ 高时，说明 KFAC 严重失效，我们需要：

1. **增加 Muon 的权重**: 更加依赖正交化更新。
2. **加速 KFAC 更新**: 此时 KFAC 的曲率估计可能过时，应减小 `T_cov` 或 `T_inv`。
3. **降低 Damping**: 允许 KFAC 更激进地白化（风险较高）。

## 5. 结论

SRM 作为动量阻尼器的尝试失败了。谱残差 $\rho$ 是一个有效的**诊断指标**，但不是一个好的**控制信号**（至少不能用于简单的负反馈控制）。

**保留价值**:
保留 `muon.py` 和 `hadron.py` 中的诊断代码。$\rho$ 的实时监控对于理解二阶优化器的行为至关重要。
